{% extends "core/_control-panel.html.twig" %}

{% block title %}{{ workshop_item.name }} - Admin{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.4/photoswipe.min.css"
        integrity="sha512-TdCx5ObKpq3+lwUdiXFgFLhqwTB98YsdaQWSJrwkOz084qaeO86+NMYfU/pnpPo1pDVah0a7yvFmbcvI8ZiGAw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{% block body_javascript %}
    <script type="module">
        import PhotoSwipeLightbox from 'https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.4/photoswipe-lightbox.esm.min.js';

        // Initialize image lightbox
        const lightbox = new PhotoSwipeLightbox({
            bgOpacity: 0.8,
            gallery: '#workshop-screenshots',
            children: 'a',
            pswpModule: () => import('https://cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.4/photoswipe.esm.min.js'),
            mainClass: 'pswp-with-perma-preloader',
            initialZoomLevel: 'fit',
            showHideAnimationType: 'zoom'
        });

        // Init lightbox
        lightbox.init();
    </script>
{% endblock %}

{% block page %}

    {% if workshop_item.isAccepted != true %}
        <div class="alert alert-info">
            This workshop item has not been accepted yet.
        </div>
    {% endif %}

    <div class="content-box bg-keeper bd-keeper">
        <div class="content-header">
            <h2>Workshop Item: {{ workshop_item.name }}</h2>
        </div>

        <div class="content-body">

            <form action="/admin/workshop/{{ workshop_item.id }}" method="POST" enctype="multipart/form-data">

                <input type="hidden" name="{{ csrf.keys.name }}" value="{{ csrf.name }}">
                <input type="hidden" name="{{ csrf.keys.value }}" value="{{ csrf.value }}">

                <div class="row form-group">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="submitter">Submitter</label>
                            <p id="submitter">
                                <a href="/admin/user/{{ workshop_item.submitter.id }}">
                                    {{ workshop_item.submitter.username }}
                                </a>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="submitter">Submission date</label>
                            <p id="submitter">
                                {{ workshop_item.createdTimestamp|date('Y-m-d') }}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" name="name" value="{{ workshop_item.name }}">
                </div>

                <div class="form-group">
                    <label for="type">Type</label>
                    <select class="form-control" id="type" name="type">
                        {% if types|length > 0 %}
                            {% for type in types %}
                                <option value="{{ type.value }}" {% if type.value == workshop_item.type %}selected=selected{% endif %}>{{ type.name }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <div class="form-group row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="file">File</label>
                            <p id="file">
                                <a href="/workshop/download/{{ workshop_item.id }}/{{ workshop_item.filename }}" download>{{ workshop_item.filename }}</a>
                            </p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="file">Change file</label>
                            <input type="file" class="form-control" id="file" name="file">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description <span class="text-muted">(Optional)</span></label>
                    <textarea class="form-control" name="description" rows="6">{{ workshop_item.description }}</textarea>
                </div>

                <div class="form-group">
                    <label for="screenshots">Screenshots <span class="text-muted">(Optional)</span></label>

                    {% if screenshots|length > 0 %}
                        <div class="workshop-screenshots" id="workshop-screenshots">
                            {% for screenshot in screenshots %}
                                <div class="workshop-screenshot">
                                    <a href="/workshop/screenshot/{{ workshop_item.id }}/{{ screenshot.filename }}"
                                        data-pswp-width="{{ screenshot.width }}"
                                        data-pswp-height="{{ screenshot.height }}"
                                        data-cropped="true"
                                        target="_blank">
                                            <img src="/workshop/screenshot/{{ workshop_item.id }}/{{ screenshot.filename }}" alt="" />
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    {# <input type="file" class="form-control" id="screenshots" name="screenshots[]" multiple="multiple"> #}
                </div>

                <div class="form-group">
                    <label for="install_instructions">Installation instructions <span class="text-muted">(Optional)</span></label>
                    <textarea class="form-control" name="install_instructions" rows="4">{{ workshop_item.installInstructions }}</textarea>
                </div>

                <div class="form-group">
                    <label for="min_game_build">Minimum game version <span class="text-muted">(Optional)</span></label>
                    <select class="form-control" id="min_game_build" name="min_game_build">
                        <option {% if workshop_item.minGameBuild == null %}selected=selected{% endif %} value="-1"></option>
                        {% if builds|length > 0 %}
                            {% for build in builds %}
                                <option value="{{ build.id }}" {% if workshop_item.minGameBuild != null and workshop_item.minGameBuild.id == build.id %}selected=selected{% endif %}>{{ build.name }}</option>
                            {% endfor %}
                        {% endif %}
                    </select>
                </div>

                <div class="form-group">
                    <div class="form-check">
                        <input
                            class="form-check-input" type="checkbox" name="is_accepted" id="is_accepted"
                            {% if workshop_item.isAccepted == true %}checked=checked{% endif %}
                        />
                        <label class="form-check-label" for="is_accepted">
                            Accepted
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <input type="submit" class="btn btn-medieval" value="Save" />
                </div>

            </form>

        </div>
    </div>

{% endblock %}
