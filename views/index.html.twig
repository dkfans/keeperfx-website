{% extends "core/_layout.html.twig" %}

{% set full_page_title = 'KeeperFX - Dungeon Keeper Opensource Remake and Fan Expansion' %}

{% set meta = {
    description: 'KeeperFX is an opensource remake of the game Dungeon Keeper. It makes the game run on modern machines and adds a ton of fan made content.'
} %}


{% block content %}

{{ render_flash_messages() }}

<div class="row">

    <div class="col-sm-8">

        {# Intro #}
        <div class="content-box bg-keeper bd-keeper">

            <div class="content-header">
                <h2>KeeperFX</h2>
            </div>
            <div class="content-body">

                {# Intro #}
                <p>
                    <strong>KeeperFX</strong> is an open-source remake and fan expansion of <a href="https://en.wikipedia.org/wiki/Dungeon_Keeper" target="_blank">Dungeon Keeper <ion-icon name="open-outline" class="outgoing"></ion-icon></a>.
                </p>
                <p>
                    The main goal of <strong>KeeperFX</strong> is to preserve and expand upon the original Dungeon Keeper experience,
                    offering many new features, improvements, and much more while staying true to the original feeling of the game.
                </p>
                <p>
                    You can delve into the <strong>original campaign</strong>, or enjoy custom content created by the community and shared on <a href="/workshop/browse" alt="Browse Workshop" data-instant>the Workshop</a>.
                </p>
                <p>
                    <h5 style="margin-left: 15px; margin-top: 35px; border-bottom: 0;">Features</h5>
                    <ul class="horned-list">
                        <li>Windows 7/10/11 support</li>
                        <li>Higher screen resolutions</li>
                        <li>Modernized controls</li>
                        <li>Many bugfixes</li>
                        <li>Additional campaigns and maps</li>
                        <li>New level script commands</li>
                        <li>New creatures, textures and sprites</li>
                        <li>Multiplayer</li>
                        <li>And much more!</li>
                    </ul>
                </p>
                <p style="margin-top: 40px;">
                    <strong>KeeperFX</strong> is a standalone game but requires the original game files to operate.
                    You can use your old CDs or the digital Gold edition that can be bought from
                    <a href="https://www.ea.com/games/dungeon-keeper/dungeon-keeper" target="_blank">EA <ion-icon name="open-outline" class="outgoing"></ion-icon></a>
                    or
                    <a href="https://www.gog.com/game/dungeon_keeper" target="_blank">GOG <ion-icon name="open-outline" class="outgoing"></ion-icon></a>
                    .
                </p>
                <p>
                    It's very easy to get started but be sure to follow the <a href="/wiki/Home" target="_blank" data-instant>installation instructions</a> as there is no automatic installer.
                </p>

            </div>
        </div>

        {# News #}
        {% if articles %}
            <div class="content-box bg-keeper bd-keeper">
                <div class="content-header">
                    <div class="d-flex justify-content-between">
                        <h2>
                            Latest News
                        </h2>
                        <div>
                            <a href="/news" data-instant>Browse all</a>
                        </div>
                    </div>
                </div>
                <div class="content-body">
                    {% for article in articles %}
                        <div class="news">
                            <h3 class="news-title">{{ article.title }}</h3>
                            <span class="news-date">{{ article.createdTimestamp|date('Y-m-d') }}</span>
                            <p class="news-content">{{ article.excerpt|markdown_to_html }}</p>
                            <p style="margin-bottom: 0px;">
                                <a href="/news/{{ article.id }}/{{ article.createdTimestamp|date('Y-m-d') }}/{{ article.titleSlug }}" data-instant>Read more</a>
                            </p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

    </div>

    <div class="col-sm-4">

        {# Download Button #}
        {% if release %}
            <a href="/downloads" alt="Download" data-instant>
                <button class="btn btn-medieval" style="padding: 16px;width: 100%; margin-bottom: 25px">
                    <h3>Download</h3>
                    <span>{{ release.name }}</span>
                </button>
            </a>
        {% endif %}

        {# Github box #}
        <div class="content-box bg-keeper bd-keeper">

            <div class="content-header">
                <h2>GitHub</h2>
            </div>
            <div class="content-body">
                Repository:
                <a href="https://github.com/dkfans/keeperfx" target="_blank">
                    dkfans/keeperfx <ion-icon name="open-outline" class="outgoing"></ion-icon>
                </a>

                <br />
                <br />

                <img alt="GitHub release (latest by date)"
                    src="https://img.shields.io/github/v/release/dkfans/keeperfx?style=flat-square">
                <img alt="GitHub all releases"
                    src="https://img.shields.io/github/downloads/dkfans/keeperfx/total?style=flat-square">
                <img alt="GitHub contributors"
                    src="https://img.shields.io/github/contributors/dkfans/keeperfx?style=flat-square">
                <img alt="GitHub last commit"
                    src="https://img.shields.io/github/last-commit/dkfans/keeperfx?style=flat-square">
                <img alt="GitHub Repo stars"
                    src="https://img.shields.io/github/stars/dkfans/keeperfx?style=flat-square">
                    {# TODO: fix github LoC counter badge, its broken? #}
                {# <img alt="Lines of code"
                    src="https://img.shields.io/tokei/lines/github/dkfans/keeperfx?style=flat-square"> #}
            </div>
        </div>

        {# Featured Twitch Stream Box #}
        {% if twitch_channel %}
            <div class="content-box bg-keeper bd-keeper">
                <div class="content-header">
                    <h2>Featured Twitch Stream</h2>
                </div>
                <div class="content-body">
                    <iframe
                        src="https://player.twitch.tv/?channel={{ twitch_channel }}&parent={{ twitch_parent_host }}&muted=true"
                        height="210px"
                        width="100%"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        {% endif %}

        {# Discord Box #}
        <div class="content-box bg-keeper bd-keeper">
            <div class="content-header">
                <h2>Keeper Klan Discord</h2>
            </div>
            <div class="content-body">
                <a href="{{ get_env('APP_DISCORD_INVITE_URL') }}" target="_blank" style="display:block;">
                    <iframe
                        src="https://discord.com/widget?id=480505152806191114&theme=dark" width="100%"
                        height="74" allowtransparency="true" frameborder="0" style="pointer-events: none;">
                    </iframe>
                </a>
            </div>
        </div>

        {# Latest workshop items #}
        {% if latest_workshop_items|length > 0  %}
            <div class="content-box bg-keeper bd-keeper">
                <div class="content-header">
                    <h2>Latest workshop items</h2>
                </div>
                <div class="content-body" style="padding-top: 10px;">
                    {% for item in latest_workshop_items %}
                        <div class="workshop-grid-item" style="margin-top: 10px;">

                            {# Thumbnail #}
                            <div class="workshop-grid-item-image-container">
                                <a href="/workshop/item/{{ item.id }}/{{ item.name|slugify }}">
                                    {% if item.images|length > 0 %}
                                        <img src="/workshop/image/{{ item.id }}/{{ item.images|first.filename }}" />
                                    {% else %}
                                        <img src="/img/no-image-256.png" />
                                    {% endif %}
                                </a>
                            </div>

                            <div class="workshop-grid-item-info">

                                {# Title #}
                                <div class="workshop-grid-item-title">
                                    <a href="/workshop/item/{{ item.id }}/{{ item.name|slugify }}">
                                        {{ item.name }}
                                    </a>
                                </div>

                                {# Info #}
                                <div class="row" style="margin-top: 10px;">

                                    <div class="col-12">

                                        {# Type #}
                                        {# <span class="text-warning"> #}
                                        <span style="margin-top: 2px; display: block; margin-bottom: 5px">
                                            {{ item.category.name|enum_beautify }}
                                        </span>

                                        {# User or Original Author #}
                                        <div class="workshop-grid-item-user">
                                            {% include 'workshop/_user_small.widget.html.twig' with {workshop_item: item, includeOriginalAuthor: true} %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

                    <div style="padding-top: 16px; text-align: left;">
                        <a href="/workshop/browse" style="margin: 0 auto;" data-instant>Browse workshop</a>
                    </div>
                </div>
            </div>
        {% endif %}

        {# Forum Threads #}
        {% if forum_threads|length > 0  %}
            <div class="content-box bg-keeper bd-keeper">
                <div class="content-header">
                    <h2>Forum Activity</h2>
                </div>
                <div class="content-body">
                    {% for thread in forum_threads %}
                        <p>
                            <a href="{{ thread.url }}" target="_blank">{{ thread.title }} <ion-icon name="open-outline" class="outgoing"></ion-icon></a>
                            <br />
                            {{ thread.date_str }}
                            <span style="margin: 0 3px" class="text-muted">&bull;</span>
                            {{ thread.replies ?? 0 }} replies
                        </p>
                    {% endfor %}
                </div>
            </div>
        {% endif %}

    </div>

</div>


{% endblock %}
