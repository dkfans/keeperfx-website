{% extends "core/_layout.html.twig" %}

{% set page_title = 'KeeperFX Config Diff Tool' %}

{% set meta = {
    title: page_title,
    description: 'A tool to get the changes between two KeeperFX configuration files.',
} %}

{% block content %}

    <div class="content-box bg-keeper bd-keeper">
        <div class="content-header">
            <h2>KeeperFX Multiplayer Host Checker (ENET)</h2>
        </div>
        <div class="content-body">

            <p>
                This tool can be used to check if a KeeperFX ENET multiplayer lobby is accessible from the internet.
                <br />It will send a handshake packet to port 5556 over UDP.
            </p>

            <input type="text" id="test-ip" class="form-control" style="max-width: 350px" value="{{ ip }}" />

            <p style="font-size: 20px; margin-top: 15px" id="test-result"></p>

            <button id="test-button" class="btn btn-medieval">Test</button>

        </div>
    </div>
{% endblock %}

{% block body_javascript %}
<script>


    $(function(){

    $('#test-button').on('click', function(e){

        // Variables
        var regex = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;
        var $button = $('#test-button');
        var ipaddress = $("#test-ip").val();

        // Show loader
        $button.buttonLoader(true);

        // Hide previous content
        $('#test-result').removeClass('text-danger text-success');
        $('#test-result').text("");

        // Check valid IPv4 address
        if (false == regex.test(ipaddress)) {
            $('#test-result').addClass('text-danger');
            $('#test-result').text("Invalid IPv4 address");
            $button.buttonLoader(false);
            return;
        }

        // Poll
        $.ajax({
            type: 'GET',
            url: '/tools/kfx-host-checker/ping/' + ipaddress,
            dataType: 'json',
            success: function(data){
                if(data.success){
                    $('#test-result').addClass('text-success');
                    $('#test-result').text("Server up and running!");
                } else {
                    $('#test-result').addClass('text-danger');
                    $('#test-result').text("Failed to connect...");
                }
            }
        }).always(function() {
            $button.buttonLoader(false);
        });
    });
});


</script>
{% endblock %}
