{% extends "workshop/_workshop_layout.html.twig" %}

{% set page_title = 'Workshop' %}

{% block workshop_content %}

    <div class="alert alert-info">
        Hi! We've recently added a lot of content from Lubiki to the workshop here.
        If you have played some of these maps before, it would help the community if you took some time to rate them.
    </div>

    <div class="content-box bd-keeper bg-keeper">
        <div class="content-header">
            <div class="d-flex justify-content-between">
                <h2>
                    Workshop items
                    {% if submitter is not null or org_author is not null %}
                        by
                        {% if submitter != null %}
                            <span class="text-special">{{ submitter }}</span>
                        {% endif %}
                        {% if org_author != null %}
                            <span class="username-link-org-author">{{ org_author }}</span>
                        {% endif %}
                    {% endif %}
                    {% if get_query_param('category') and workshop_globals.categories_map[get_query_param('category')] is defined %}
                        : {{ workshop_globals.categories_map[get_query_param('category')]|enum_beautify }}
                    {% endif %}
                </h2>
                <div>
                    {% if submitter != null or org_author != null %}
                        <a href="/workshop/browse">Back to workshop browse</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="content-menu d-flex justify-content-between">

            <div class="d-flex" id="browse-filters">

                {# Order by #}
                <div class="dropdown me-2">
                    {% if get_query_param('order_by') and get_query_param('order_by') is string %}
                        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            Order by:
                            {% if get_query_param('order_by') == 'latest' %}
                                Latest
                            {% elseif get_query_param('order_by') == 'most-downloaded' %}
                                Most Downloaded
                            {% elseif get_query_param('order_by') == 'highest-rated' %}
                                Highest Rated
                            {% elseif get_query_param('order_by') == 'name' %}
                                Name
                            {% endif %}
                        </button>
                    {% else %}
                        <button type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            Order by: Latest
                        </button>
                    {% endif %}
                    <ul class="dropdown-menu dropdown-menu-dark">
                        {% if get_query_param('order_by') %}
                            <li><a class="dropdown-item" href="#" data-browse-filter-type="order_by" data-browse-filter-value="">Remove filter</a></li>
                            <li><hr class="dropdown-divider"></li>
                        {% endif %}
                        <li><a class="dropdown-item" href="#" data-browse-filter-type="order_by" data-browse-filter-value="latest">Latest</a></li>
                        <li><a class="dropdown-item" href="#" data-browse-filter-type="order_by" data-browse-filter-value="most-downloaded">Most Downloaded</a></li>
                        <li><a class="dropdown-item" href="#" data-browse-filter-type="order_by" data-browse-filter-value="highest-rated">Highest Rated</a></li>
                        <li><a class="dropdown-item" href="#" data-browse-filter-type="order_by" data-browse-filter-value="name">Name</a></li>
                    </ul>
                </div>

                {# Category #}
                {# <div class="dropdown me-2">
                    {% if get_query_param('category') and get_query_param('category') is string and workshop_globals.categories_map[get_query_param('category')] is defined %}
                        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            Category:
                            {{ workshop_globals.categories_map[get_query_param('category')]|enum_beautify }}
                        </button>
                    {% else %}
                        <button type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                            Category
                        </button>
                    {% endif %}
                    <ul class="dropdown-menu dropdown-menu-dark">
                        {% if get_query_param('category') %}
                            <li><a class="dropdown-item" href="#" data-browse-filter-type="category" data-browse-filter-value="">Remove filter</a></li>
                            <li><hr class="dropdown-divider"></li>
                        {% endif %}
                        {% for category in categories %}
                            <li><a class="dropdown-item" href="#" data-browse-filter-type="category" data-browse-filter-value="{{ category.value }}">{{ category.name|enum_beautify }}</a></li>
                        {% endfor %}
                    </ul>
                </div> #}

            </div>

            <div class="" style="margin-top: 4px;">
                {# Pagination #}
                {% include 'workshop/_workshop_browse_pagination.html.twig' %}
            </div>

        </div>

        <div class="content-body" style="padding-top: 0px;">

            {# Show notice when no items #}
            {% if workshop_items|length == 0 %}
                <p style="margin: 15px 0 0 0;">No workshop items found</p>
            {% endif %}

            <div class="workshop-grid">

                {% for item in workshop_items %}
                    <div class="workshop-grid-item">

                        {# Thumbnail #}
                        <div class="workshop-grid-item-image-container">
                            <a href="/workshop/item/{{ item.id }}/{{ item.name|slugify }}">
                                {% if item.images|length > 0 %}
                                    <img src="/workshop/image/{{ item.id }}/{{ item.images|first.filename }}" />
                                {% else %}
                                    <img src="/img/horny-face.png" />
                                {% endif %}
                            </a>
                        </div>

                        <div class="workshop-grid-item-info">

                            {# Title #}
                            <div class="workshop-grid-item-title">
                                <a href="/workshop/item/{{ item.id }}/{{ item.name|slugify }}">
                                    {{ item.name }}
                                </a>
                            </div>

                            {# Info #}
                            <div class="row" style="margin-top: 10px;">

                                <div class="col-7">

                                    {# Type #}
                                    {# <span class="text-warning"> #}
                                    <span style="margin-top: 2px; display: block; margin-bottom: 5px">
                                        {{ item.category.name|enum_beautify }}
                                    </span>

                                    {# User or Original Author #}
                                    {% include 'workshop/_user_small.widget.html.twig' with {workshop_item: item, includeOriginalAuthor: true} %}

                                </div>

                                <div class="col-5" style="text-align: right;">

                                    {# Quality Rating #}
                                    {% if item.ratingScore is not null %}
                                        {{ render_workshop_quality_rating(item.id, item.ratingScore) }}
                                    {% endif %}

                                    {# Difficulty Rating #}
                                    {% if item.difficultyRatingEnabled and item.difficultyRatingScore is not null and item.category not in workshop_globals.categories_without_difficulty %}
                                        {{ render_workshop_difficulty_rating(item.id, item.difficultyRatingScore) }}
                                    {% endif %}

                                    {# Date #}
                                    {# {% if item.originalCreationDate is not null %}
                                        {{ item.originalCreationDate|date('Y-m-d') }}
                                    {% else %}
                                        {{ item.updatedTimestamp|date('Y-m-d') }}
                                    {% endif %} #}

                                    {# Downloads #}
                                    {# <span style="margin-top: 7px; display: inline-block;">
                                        {{ item.downloadCount }}
                                        {% if item.downloadCount == 1 %}
                                            download
                                        {% else %}
                                            downloads
                                        {% endif %}
                                    </span> #}
                                </div>

                            </div>

                        </div>

                    </div>
                {% endfor %}

                {# Fix the grid having only 1 column when there is only 1 workshop item #}
                {% if workshop_items|length == 1 %}
                    <div></div>
                {% endif %}

            </div>
        </div>


        {# Pagination (bottom) #}
        {% if pagination|length > 1 %}
            <div class="content-menu d-flex justify-content-start" style="padding-top: 0px;">
                <div class="" style="margin-top: 4px;">
                    {% include 'workshop/_workshop_browse_pagination.html.twig' %}
                </div>
            </div>
        {% endif %}

    </div>

{% endblock %}

{% block body_javascript %}
    <script src="{{ asset('js/workshop.js') }}"></script>
{% endblock %}
